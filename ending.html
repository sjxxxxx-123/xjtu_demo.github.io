<!-- author: sjxxxx -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»“å±€ - XJTUæœ¬ç§‘æ¨¡æ‹Ÿå™¨</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- ç»“å±€ç•Œé¢ -->
    <div id="ending-screen" class="screen active">
        <div class="ending-container">
            <div class="ending-icon" id="ending-icon">ğŸ“</div>
            <h2 class="ending-title" id="ending-title">æ¯•ä¸šäº†ï¼</h2>
            <p class="ending-desc" id="ending-desc">æ­å–œä½ å®Œæˆäº†å››å¹´çš„å¤§å­¦ç”Ÿæ´»</p>
            <div class="ending-stats" id="ending-stats">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div class="ending-achievements" id="ending-achievements">
                <!-- åŠ¨æ€ç”Ÿæˆ -->
            </div>
            <div class="ending-actions">
                <button id="btn-restart" class="btn btn-primary">é‡æ–°å¼€å§‹</button>
                <button id="btn-view-achievements" class="btn btn-secondary">æŸ¥çœ‹æˆå°±</button>
            </div>
        </div>
    </div>

    <script src="js/achievements.js"></script>
    <script>
        const endings = {
            dropout: {
                icon: 'ğŸ˜¢',
                title: 'è‚„ä¸šç»“å±€',
                desc: 'å¾ˆé—æ†¾ï¼Œä½ æ²¡èƒ½å®Œæˆå­¦ä¸šã€‚ä½†è¿™ä¸æ˜¯ç»“æŸï¼Œäººç”Ÿè¿˜æœ‰å¾ˆå¤šå¯èƒ½æ€§...',
                color: '#f44336'
            },
            normal: {
                icon: 'ğŸ“',
                title: 'æ™®é€šæ¯•ä¸š',
                desc: 'ä½ é¡ºåˆ©å®Œæˆäº†å››å¹´å¤§å­¦ç”Ÿæ´»ï¼Œæ‹¿åˆ°äº†æ¯•ä¸šè¯ã€‚å¹³å‡¡è€Œçè´µçš„é’æ˜¥ã€‚',
                color: '#4CAF50'
            },
            postgraduate: {
                icon: 'ğŸ“š',
                title: 'ä¿ç ”æˆåŠŸ',
                desc: 'ä¼˜å¼‚çš„æˆç»©è®©ä½ è·å¾—äº†ä¿ç ”èµ„æ ¼ï¼Œç»§ç»­åœ¨å­¦æœ¯é“è·¯ä¸Šå‰è¿›ï¼',
                color: '#2196F3'
            },
            excellent: {
                icon: 'ğŸ†',
                title: 'ä¼˜ç§€æ¯•ä¸šç”Ÿ',
                desc: 'ä½ æ˜¯å¹´çº§çš„ä½¼ä½¼è€…ï¼Œè·å¾—äº†ä¼˜ç§€æ¯•ä¸šç”Ÿç§°å·ï¼Œå‰é€”æ— é‡ï¼',
                color: '#FF9800'
            },
            westward: {
                icon: 'ğŸš€',
                title: 'è¥¿è¿ç²¾ç¥ä¼ æ‰¿è€…',
                desc: 'ä½ æ·±åˆ»ç†è§£äº†è¥¿è¿ç²¾ç¥ï¼Œé€‰æ‹©å»è¥¿éƒ¨å»ºè®¾ç¥–å›½ï¼Œæˆä¸ºæ–°æ—¶ä»£çš„è¥¿è¿äººï¼',
                color: '#9C27B0'
            }
        };

        document.addEventListener('DOMContentLoaded', function() {
            // è·å–ç»“å±€ç±»å‹
            const urlParams = new URLSearchParams(window.location.search);
            const endingType = urlParams.get('type') || 'normal';
            const ending = endings[endingType] || endings.normal;

            // æ›´æ–°ç•Œé¢
            document.getElementById('ending-icon').textContent = ending.icon;
            document.getElementById('ending-title').textContent = ending.title;
            document.getElementById('ending-title').style.color = ending.color;
            document.getElementById('ending-desc').textContent = ending.desc;

            // è·å–æ¸¸æˆçŠ¶æ€æ˜¾ç¤ºç»Ÿè®¡
            const savedState = localStorage.getItem('xjtu_game_state');
            if (savedState) {
                const state = JSON.parse(savedState);
                const statsDiv = document.getElementById('ending-stats');
                statsDiv.innerHTML = `
                    <div class="ending-stat-item">
                        <span class="stat-label">æœ€ç»ˆGPA</span>
                        <span class="stat-value">${state.gpa ? state.gpa.toFixed(2) : '0.00'}</span>
                    </div>
                    <div class="ending-stat-item">
                        <span class="stat-label">ç»¼æµ‹åˆ†æ•°</span>
                        <span class="stat-value">${state.social || 0}</span>
                    </div>
                    <div class="ending-stat-item">
                        <span class="stat-label">æŒ‚ç§‘æ¬¡æ•°</span>
                        <span class="stat-value">${state.failedCourses || 0}</span>
                    </div>
                    <div class="ending-stat-item">
                        <span class="stat-label">å‰©ä½™é‡‘å¸</span>
                        <span class="stat-value">ğŸ’° ${state.money || 0}</span>
                    </div>
                `;
            }

            // æ˜¾ç¤ºè§£é”çš„æˆå°±
            const achievementList = AchievementSystem.getAchievementList();
            const unlockedAchievements = achievementList.filter(a => a.unlocked);
            const achievementsDiv = document.getElementById('ending-achievements');
            
            if (unlockedAchievements.length > 0) {
                achievementsDiv.innerHTML = `
                    <h3>ğŸ† æœ¬æ¬¡è§£é”æˆå°± (${unlockedAchievements.length}/${achievementList.length})</h3>
                    <div class="ending-achievements-list">
                        ${unlockedAchievements.slice(0, 6).map(a => `
                            <div class="ending-achievement-item">
                                <span class="icon">${a.icon}</span>
                                <span class="name">${a.name}</span>
                            </div>
                        `).join('')}
                        ${unlockedAchievements.length > 6 ? `<div class="ending-achievement-more">è¿˜æœ‰ ${unlockedAchievements.length - 6} ä¸ª...</div>` : ''}
                    </div>
                `;
            }

            // è§£é”æ¯•ä¸šæˆå°±
            if (endingType !== 'dropout') {
                AchievementSystem.unlock('graduation');
            }

            // æŒ‰é’®äº‹ä»¶
            document.getElementById('btn-restart').addEventListener('click', function() {
                localStorage.removeItem('xjtu_game_state');
                window.location.href = 'index.html';
            });

            document.getElementById('btn-view-achievements').addEventListener('click', function() {
                window.location.href = 'achievements.html';
            });
        });
    </script>
</body>
</html>

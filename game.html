<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>游戏中 - XJTU本科模拟器</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/mobile_v2.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- 主游戏界面 -->
    <div id="game-screen" class="screen active">
        <!-- 顶部状态栏 -->
        <header class="game-header">
            <div class="time-info">
                <span id="current-year">大一</span>
                <span id="current-month">9月</span>
                <span id="current-semester">秋季学期</span>
            </div>
            <div class="location-info">
                <span id="current-location">兴庆校区</span>
            </div>
            <button id="btn-menu" class="btn-icon">☰</button>
        </header>

        <!-- 移动端顶部状态条 (移除，合并到下方) -->
        <!-- <div class="mobile-compact-header mobile-only-flex"> REMOVED </div> -->

        <!-- 游戏内容容器 (扁平化结构，移除Tabs) -->
        <!-- 移动端：上方反馈区域 -->
        <div id="mobile-top-section" class="mobile-only-block" style="margin-top: 10px;">
            <!-- 移动端动态反馈卡片 (合并版) -->
            <div class="mobile-status-card">
                <!-- 第一行：核心资源 (体力/SAN/金钱) -->
                <div class="m-card-row resource-row">
                    <div class="m-stat-compact">
                         <span class="label">体力</span>
                         <span class="value" id="m-val-energy">10/10</span>
                    </div>
                    <div class="m-stat-compact">
                         <span class="label">SAN值</span>
                         <span class="value" id="m-val-san">80</span>
                    </div>
                    <div class="m-stat-compact">
                         <span class="label">金币</span>
                         <span class="value" id="m-val-money">1000</span>
                    </div>
                </div>
                <!-- 第二行：长期属性 (GPA/综测/声望) -->
                <div class="m-card-row attribute-row">
                    <div class="m-stat-compact">
                        <span class="label">GPA</span>
                        <span class="value" id="m-val-gpa">3.00</span>
                    </div>
                    <div class="m-stat-compact">
                        <span class="label">综测</span>
                        <span class="value" id="m-val-social">60</span>
                    </div>
                    <div class="m-stat-compact">
                        <span class="label">声望</span>
                        <span class="value" id="m-val-reputation">50</span>
                    </div>
                </div>
                <!-- 日志预览 -->
                <div class="m-log-preview" id="mobile-log-preview">
                    <span class="m-log-icon">📢</span>
                    <span id="m-log-text">欢迎来到西安交通大学！</span>
                </div>
            </div>
        </div>

        <!-- BBS舆论滚动条 -->
        <div class="bbs-ticker desktop-only" id="bbs-ticker">
            <div class="bbs-label">📢 交大BBS</div>
            <div class="bbs-scroll" id="bbs-scroll">
                <span class="bbs-item">欢迎来到西安交通大学！</span>
            </div>
        </div>

        <!-- 属性面板 -->
        <div class="stats-panel desktop-only">
            <div class="stat-item">
                <div class="stat-label">GPA</div>
                <div class="stat-value" id="stat-gpa">3.00/4.3</div>
                <div class="stat-bar">
                    <div class="stat-fill gpa" id="bar-gpa" style="width: 70%"></div>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-label">SAN值</div>
                <div class="stat-value" id="stat-san">80/100</div>
                <div class="stat-bar">
                    <div class="stat-fill san" id="bar-san" style="width: 80%"></div>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-label">体力</div>
                <div class="stat-value" id="stat-energy">10/10</div>
                <div class="stat-bar">
                    <div class="stat-fill energy" id="bar-energy" style="width: 100%"></div>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-label">综测</div>
                <div class="stat-value" id="stat-social">60</div>
                <div class="stat-bar">
                    <div class="stat-fill social" id="bar-social" style="width: 60%"></div>
                </div>
            </div>
             <div class="stat-item">
                <div class="stat-label">声望</div>
                <div class="stat-value" id="stat-reputation">⭐ 50</div>
                <div class="stat-bar">
                    <div class="stat-fill reputation" id="bar-reputation" style="width: 50%"></div>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-label">金币</div>
                <div class="stat-value" id="stat-money">💰 1000</div>
            </div>
        </div>

        <!-- 课程掌握度面板 -->
        <div class="course-panel" id="course-panel">
            <div class="panel-header-mobile-toggle">
                <h3>📖 当前课程</h3>
            </div>
            <div class="course-list" id="course-list">
                <!-- 动态生成 -->
            </div>
        </div>
        
        <!-- 长远规划面板（大三下开启） -->
        <div class="career-panel" id="career-panel" style="display: none;">
            <h3>🎯 长远规划</h3>
            <div class="career-info" id="career-info">
                <span class="career-path">未选择方向</span>
            </div>
            <div class="career-progress" id="career-progress"></div>
        </div>

        <!-- 移动端：行动分类过滤器 -->
        <div class="mobile-action-filter mobile-only-flex">
            <button class="filter-btn active" data-filter="all">🌟 全部</button>
            <button class="filter-btn" data-filter="study">📚 学习</button>
            <button class="filter-btn" data-filter="life">☕ 生活</button>
            <button class="filter-btn" data-filter="social">🤝 发展</button>
        </div>

        <!-- 行动区域 -->
        <div class="action-panel">
            <h3 class="desktop-only">选择行动</h3>
            <div class="action-grid" id="action-grid">
                <button class="action-btn study" data-action="attend-class">
                    <span class="action-icon">📚</span>
                    <span class="action-name">去上课</span>
                    <span class="action-cost">体力 -2</span>
                </button>
                <button class="action-btn study" data-action="self-study">
                    <span class="action-icon">📖</span>
                    <span class="action-name">去自习</span>
                    <span class="action-cost">体力 -3, SAN -2</span>
                </button>
                <button class="action-btn life" data-action="run" id="btn-run">
                    <span class="action-icon">🏃</span>
                    <span class="action-name">操场跑步</span>
                    <span class="action-cost">体力 -1, 体力上限+</span>
                </button>
                <button class="action-btn social" data-action="club">
                    <span class="action-icon">🎭</span>
                    <span class="action-name">搞社团</span>
                    <span class="action-cost">体力 -2, SAN +3</span>
                </button>
                <button class="action-btn social" data-action="volunteer">
                    <span class="action-icon">🤝</span>
                    <span class="action-name">做志愿</span>
                    <span class="action-cost">体力 -2</span>
                </button>
                <button class="action-btn study" data-action="parttime">
                    <span class="action-icon">💼</span>
                    <span class="action-name">去兼职</span>
                    <span class="action-cost">体力 -3, 金币 +100~200</span>
                </button>
                <button class="action-btn study" data-action="competition">
                    <span class="action-icon">🏆</span>
                    <span class="action-name">参加竞赛</span>
                    <span class="action-cost">体力 -4, SAN -5</span>
                </button>
                <button class="action-btn study" data-action="research">
                    <span class="action-icon">🔬</span>
                    <span class="action-name">科研实习</span>
                    <span class="action-cost">体力 -3, SAN -3</span>
                </button>
                <button class="action-btn study special" data-action="career" id="btn-career" style="display: none;">
                    <span class="action-icon">🎯</span>
                    <span class="action-name">长远规划</span>
                    <span class="action-cost">规划未来方向</span>
                </button>
                <button class="action-btn life" data-action="eat">
                    <span class="action-icon">🍱</span>
                    <span class="action-name">改善伙食</span>
                    <span class="action-cost">金币 -80, SAN +??</span>
                </button>
                <button class="action-btn life" data-action="entertainment">
                    <span class="action-icon">🎮</span>
                    <span class="action-name">娱乐放松</span>
                    <span class="action-cost">金币 -50, SAN +10</span>
                </button>
                <button class="action-btn life" data-action="bath">
                    <span class="action-icon">🚿</span>
                    <span class="action-name">去洗澡</span>
                    <span class="action-cost">SAN +8</span>
                </button>
                <button class="action-btn life special" data-action="love" id="btn-love" title="恋爱模块">
                    <span class="action-icon">❤️</span>
                    <span class="action-name">恋爱</span>
                    <span class="action-cost">解锁条件</span>
                </button>
                <button class="action-btn life special" data-action="date" id="btn-date" style="display: none;">
                    <span class="action-icon">💕</span>
                    <span class="action-name">约会</span>
                    <span class="action-cost">金币 -100, SAN +15</span>
                </button>
                <button class="action-btn life special" data-action="rest">
                    <span class="action-icon">😴</span>
                    <span class="action-name">休息</span>
                    <span class="action-cost">SAN +5</span>
                </button>
            </div>
        </div>
        
        <!-- 下一回合按钮：桌面端保留 -->
        <div class="turn-control desktop-only">
            <button id="btn-next-turn" class="btn btn-primary btn-large">
                结束本月 ▶
            </button>
        </div>

        <!-- 事件日志 (桌面) -->
        <div class="event-log desktop-only" id="event-log">
            <h3>📋 事件记录</h3>
            <div class="log-content" id="log-content">
                <p class="log-entry">欢迎来到西安交通大学！新的大学生活开始了...</p>
            </div>
        </div>

        <!-- 移除移动端底部导航栏 nav class="bottom-nav" -->
    </div>

    <!-- 选择弹窗 -->
    <div id="choice-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="choice-title">请选择</h3>
                <button class="modal-close" id="choice-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="choice-options" id="choice-options"></div>
            </div>
        </div>
    </div>

    <!-- 成就解锁弹窗 -->
    <div id="achievement-popup" class="achievement-popup">
        <div class="achievement-popup-content">
            <div class="achievement-icon">🏆</div>
            <div class="achievement-text">
                <span class="achievement-label">成就解锁！</span>
                <span class="achievement-name" id="achievement-name"></span>
            </div>
        </div>
    </div>

    <!-- 游戏菜单 -->
    <div id="game-menu" class="modal">
        <div class="modal-content menu-content">
            <h3>游戏菜单</h3>
            <div class="menu-buttons">
                <button id="btn-save" class="btn btn-secondary">💾 保存游戏</button>
                <button id="btn-view-achievements" class="btn btn-secondary">🏆 查看成就</button>
                <button id="btn-view-profile" class="btn btn-secondary">👤 个人经历</button>
                <button id="btn-settings" class="btn btn-secondary">⚙️ 游戏设置</button>
                <button id="btn-quit" class="btn btn-danger">🚪 退出游戏</button>
            </div>
            <button id="btn-close-menu" class="btn btn-primary">继续游戏</button>
        </div>
    </div>

    <!-- 考试弹窗 -->
    <div id="exam-modal" class="modal">
        <div class="modal-content exam-content">
            <div class="modal-header">
                <h3 class="modal-title">📝 期末考试</h3>
            </div>
            <div class="modal-body">
                <div class="exam-results" id="exam-results"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="exam-confirm">确认</button>
            </div>
        </div>
    </div>

    <!-- 补考选择弹窗 -->
    <div id="makeup-exam-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">📋 挂科处理</h3>
            </div>
            <div class="modal-body">
                <p class="makeup-hint">
                    <strong>补考规则：</strong>只有专业课可以申请补考，补考通过按60分计入成绩。<br>
                    通识课、体育课及补考不通过的课程需要下学期重修。
                </p>
                <div class="makeup-courses" id="makeup-courses"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="makeup-confirm">确认</button>
            </div>
        </div>
    </div>

    <!-- 补考进行弹窗 -->
    <div id="makeup-exam-result-modal" class="modal">
        <div class="modal-content exam-content">
            <div class="modal-header">
                <h3 class="modal-title">📝 补考结果</h3>
            </div>
            <div class="modal-body">
                <div class="exam-results" id="makeup-exam-results"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="makeup-result-confirm">确认</button>
            </div>
        </div>
    </div>

    <!-- 选课博弈弹窗 -->
    <div id="course-bidding-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">📋 选课系统开放</h3>
            </div>
            <div class="modal-body">
                <p class="bidding-desc">新学期选课开始！你有 <strong>100</strong> 权重分需要分配给三类课程。</p>
                <div class="bidding-pools">
                    <div class="bidding-pool">
                        <div class="pool-header">
                            <span class="pool-icon">🌊</span>
                            <span class="pool-name">水课池</span>
                        </div>
                        <div class="pool-desc">难度低，GPA提升快</div>
                        <input type="range" id="weight-easy" min="0" max="100" value="34" class="weight-slider" oninput="game.updateBiddingTotal()">
                        <span class="weight-value">34</span>
                    </div>
                    <div class="bidding-pool">
                        <div class="pool-header">
                            <span class="pool-icon">💪</span>
                            <span class="pool-name">硬课池</span>
                        </div>
                        <div class="pool-desc">难度高，科研/技能提升多</div>
                        <input type="range" id="weight-hard" min="0" max="100" value="33" class="weight-slider" oninput="game.updateBiddingTotal()">
                        <span class="weight-value">33</span>
                    </div>
                    <div class="bidding-pool">
                        <div class="pool-header">
                            <span class="pool-icon">🎨</span>
                            <span class="pool-name">兴趣课池</span>
                        </div>
                        <div class="pool-desc">SAN值恢复快，轻松愉快</div>
                        <input type="range" id="weight-interest" min="0" max="100" value="33" class="weight-slider" oninput="game.updateBiddingTotal()">
                        <span class="weight-value">33</span>
                    </div>
                </div>
                <div class="weight-total">当前总权重: <span id="total-weight">100</span>/100</div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="confirm-bidding">确认选课</button>
            </div>
        </div>
    </div>

    <!-- 体测弹窗 -->
    <div id="physical-test-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">🏃 体测月来临！</h3>
            </div>
            <div class="modal-body">
                <p id="physical-test-desc">又到了体测的时候...</p>
                <div class="physical-test-status" id="physical-test-status">
                    <div class="test-item">
                        <span class="test-label">体力上限</span>
                        <span class="test-value" id="test-stamina-value">10/12</span>
                        <span class="test-result" id="test-stamina-result">❌</span>
                    </div>
                    <div class="test-item">
                        <span class="test-label">本月跑步次数</span>
                        <span class="test-value" id="test-run-value">0/3</span>
                        <span class="test-result" id="test-run-result">❌</span>
                    </div>
                </div>
                <div class="test-warning" id="test-warning" style="display: none;">
                    ⚠️ 体测不达标将扣除综测分并影响SAN值！
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="physical-test-confirm">确认</button>
            </div>
        </div>
    </div>

    <!-- 长远规划选择弹窗 -->
    <div id="career-choice-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">🎯 选择你的未来方向</h3>
            </div>
            <div class="modal-body">
                <p>大三下学期了，是时候规划未来了。请选择一个方向：</p>
                <div class="career-choices">
                    <button class="career-choice-btn" data-career="postgrad">
                        <div class="career-icon">🎓</div>
                        <div class="career-name">保研深造</div>
                        <div class="career-desc">找导师、大创项目、竞赛加分</div>
                    </button>
                    <button class="career-choice-btn" data-career="abroad">
                        <div class="career-icon">✈️</div>
                        <div class="career-name">出国留学</div>
                        <div class="career-desc">托福/GRE、申请材料、金币消耗翻倍</div>
                    </button>
                    <button class="career-choice-btn" data-career="job">
                        <div class="career-icon">💼</div>
                        <div class="career-name">就业工作</div>
                        <div class="career-desc">实习、面试、金币增加、Mastery变慢</div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 小学期弹窗 -->
    <div id="summer-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">☀️ 小学期来临！</h3>
            </div>
            <div class="modal-body">
                <p id="summer-desc">七月炎炎，小学期开始了！</p>
                <div class="summer-options" id="summer-options"></div>
            </div>
        </div>
    </div>

    <!-- 月末随机事件弹窗 -->
    <div id="random-event-modal" class="modal">
        <div class="modal-content random-event-content">
            <div class="event-header">
                <div class="event-icon-large" id="random-event-icon">📦</div>
                <h3 class="event-title" id="random-event-title">事件标题</h3>
            </div>
            <div class="event-body">
                <p class="event-description" id="random-event-desc">事件描述...</p>
                <div class="event-options" id="random-event-options">
                    <!-- 动态生成选项 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 事件结果弹窗 -->
    <div id="event-result-modal" class="modal">
        <div class="modal-content event-result-content">
            <div class="result-icon" id="result-icon">✨</div>
            <div class="result-message" id="result-message">结果消息</div>
            <div class="result-effects" id="result-effects">
                <!-- 效果变化 -->
            </div>
            <button class="btn btn-primary" id="result-confirm">确定</button>
        </div>
    </div>

    <!-- 脚本引入 -->
    <!-- 设置 Modal -->
    <div id="settings-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">AI 设置</h3>
                <button class="modal-close" id="settings-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group" style="margin-bottom: 15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:bold;">API 接入</label>
                    <div style="padding: 10px; background: #f0f7ff; border-radius: 4px; border-left: 4px solid #003E7E; font-size: 0.9rem; margin-bottom: 15px;">
                        当前使用: <strong>XJTU AI Proxy</strong><br>
                        无需翻墙，支持 DeepSeek 模型。
                    </div>
                </div>
                <div class="form-group" style="margin-bottom: 15px;">
                    <label style="display:block; margin-bottom:5px; font-weight:bold;">API Key</label>
                    <input type="password" id="setting-api-key" placeholder="请输入你的 API Key" style="width:100%; padding:8px; border-radius:4px; border:1px solid #ccc;">
                    <p style="font-size:0.8rem; color:#666; margin-top:5px;">
                        * Key 仅存储在本地浏览器中，不会上传服务器。<br>
                        * 可以在本地 config.js 中配置，也可以在此处输入。
                    </p>
                </div>
                <!-- 隐藏的高级设置（折叠） -->
                <div style="margin-bottom: 10px;">
                    <a href="#" onclick="document.getElementById('advanced-settings').style.display = document.getElementById('advanced-settings').style.display === 'none' ? 'block' : 'none'; return false;" style="font-size: 0.85rem; color: #666; text-decoration: underline;">
                        高级设置（自定义 Endpoint）
                    </a>
                </div>
                <div id="advanced-settings" style="display:none;">
                    <div class="form-group" style="margin-bottom: 15px;">
                        <label style="display:block; margin-bottom:5px; font-weight:bold;">API Endpoint</label>
                        <input type="text" id="setting-endpoint" placeholder="https://ai.xjtu.edu.cn/api/proxy/api/v1" style="width:100%; padding:8px; border-radius:4px; border:1px solid #ccc;">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="settings-save">保存配置</button>
            </div>
        </div>
    </div>

    <!-- 通用信息弹窗 (用于 showMessage) -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">提示</h3>
                <button class="modal-close" onclick="document.getElementById('modal').classList.remove('active')">&times;</button>
            </div>
            <div class="modal-body" id="modal-body"></div>
            <div class="modal-footer">
                <button class="btn btn-primary" id="modal-confirm" onclick="document.getElementById('modal').classList.remove('active')">确定</button>
            </div>
        </div>
    </div>

    <!-- 移动端日志详情弹窗 -->
    <div id="mobile-log-modal" class="modal">
        <div class="modal-content" style="max-height: 80vh; display: flex; flex-direction: column;">
             <div class="modal-header">
                <h3 class="modal-title">📜 事件记录</h3>
                <button class="modal-close mobile-log-close">&times;</button>
            </div>
            <div class="modal-body" id="mobile-log-body" style="flex: 1; overflow-y: auto; padding: 15px;">
                <!-- Logs copied here -->
            </div>
        </div>
    </div>

    <script src="js/data.js"></script>
    <script src="js/config.js"></script>
    <script src="js/ai_module.js"></script>
    <script src="js/achievements.js"></script>
    <script src="js/events.js"></script>
    <script src="js/game.js"></script>
</body>
</html>
